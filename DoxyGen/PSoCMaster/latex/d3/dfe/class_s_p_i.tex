\hypertarget{class_s_p_i}{}\subsection{S\+PI Klasse-\/reference}
\label{class_s_p_i}\index{S\+PI@{S\+PI}}


\hyperlink{class_s_p_i}{S\+PI} class.  




{\ttfamily \#include $<$spi.\+h$>$}



Samarbejdsdiagram for S\+PI\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=147pt]{dd/d16/class_s_p_i__coll__graph}
\end{center}
\end{figure}
\subsubsection*{Offentlige metoder}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{class_s_p_i_a5db0aceecaf7db5fbe2984e88fef3734}{spi\+\_\+init} ()
\begin{DoxyCompactList}\small\item\em Initialiser \hyperlink{class_s_p_i}{S\+PI} modulet. \end{DoxyCompactList}\item 
\hyperlink{class_s_p_i_ae65228150b9bf9ec06e2c3260dcbc328}{C\+Y\+\_\+\+I\+SR} (isr\+\_\+spi\+\_\+rx)
\begin{DoxyCompactList}\small\item\em Modtager kald fra S\+P\+I-\/busset. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsubsection{Detaljeret beskrivelse}
\hyperlink{class_s_p_i}{S\+PI} class. 

Håndter kommunikation via S\+P\+I-\/busset. \begin{DoxyAuthor}{Forfatter}
Jeppe Stærk Antonsen (\href{mailto:201271201@uni.au.dk}{\tt 201271201@uni.\+au.\+dk}) 
\end{DoxyAuthor}


\subsubsection{Dokumentation af medlemsfunktioner}
\index{S\+PI@{S\+PI}!C\+Y\+\_\+\+I\+SR@{C\+Y\+\_\+\+I\+SR}}
\index{C\+Y\+\_\+\+I\+SR@{C\+Y\+\_\+\+I\+SR}!S\+PI@{S\+PI}}
\paragraph[{\texorpdfstring{C\+Y\+\_\+\+I\+S\+R(isr\+\_\+spi\+\_\+rx)}{CY_ISR(isr_spi_rx)}}]{\setlength{\rightskip}{0pt plus 5cm}C\+Y\+\_\+\+I\+SR (
\begin{DoxyParamCaption}
\item[{isr\+\_\+spi\+\_\+rx}]{}
\end{DoxyParamCaption}
)}\hypertarget{class_s_p_i_ae65228150b9bf9ec06e2c3260dcbc328}{}\label{class_s_p_i_ae65228150b9bf9ec06e2c3260dcbc328}


Modtager kald fra S\+P\+I-\/busset. 

En \char`\"{}\+Interrupt Service Routine(\+I\+S\+R)\char`\"{} der aktiveres ved modtagelse af kald via S\+P\+I-\/busset, det modtaget data behandles og håndteres.

\begin{DoxyAuthor}{Forfatter}
Jeppe Stærk (\href{mailto:201271201@uni.au.dk}{\tt 201271201@uni.\+au.\+dk}) 
\end{DoxyAuthor}


Defineret på linje 41 i filen spi.\+c.



Indeholder referencer til Data\+Master\+::b\+Val, Action\+::cmd, C\+M\+D\+\_\+\+G\+E\+T\+\_\+\+B\+L\+U\+E\+\_\+\+V\+AL, C\+M\+D\+\_\+\+G\+E\+T\+\_\+\+G\+R\+E\+E\+N\+\_\+\+V\+AL, C\+M\+D\+\_\+\+G\+E\+T\+\_\+\+R\+E\+D\+\_\+\+V\+AL, C\+M\+D\+\_\+\+G\+E\+T\+\_\+\+X\+\_\+\+P\+OS, C\+M\+D\+\_\+\+G\+E\+T\+\_\+\+Y\+\_\+\+P\+OS, C\+M\+D\+\_\+\+G\+E\+T\+\_\+\+Z\+\_\+\+P\+OS, data\+Master, Data\+Master\+::g\+Val, L\+C\+D\+::lcd\+\_\+newline(), Queue\+::push\+Queue(), Data\+Master\+::r\+Val, S\+P\+I\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+D\+A\+T\+A\+\_\+\+P\+OS, S\+P\+I\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+ZE, Action\+::val, Data\+Master\+::x\+Val, Data\+Master\+::y\+Val og Data\+Master\+::z\+Val.


\begin{DoxyCode}
42 \{
43   SPIS\_DisableInt();
44   \textcolor{keywordtype}{char} lcd[12];
45   uint16 spiRxBuffer[\hyperlink{spi_8h_aea54fc09a960e5a1b7096374f3eebee4}{SPI\_PACKET\_SIZE}];
46   uint16 spiTxBuffer[\hyperlink{spi_8h_aea54fc09a960e5a1b7096374f3eebee4}{SPI\_PACKET\_SIZE}];
47   \textcolor{keyword}{struct }\hyperlink{queue_8h_df/d8c/struct_action}{Action} spiRxAction;
48   
49   \textcolor{keywordflow}{while}(SPIS\_SpiUartGetRxBufferSize() > 0)
50   \{
51     spiRxBuffer[\hyperlink{spi_8h_a5ffe58623f478b7b960a1349530a6655}{SPI\_PACKET\_DATA\_POS}] = SPIS\_SpiUartReadRxData();
52     spiRxAction.val = spiRxBuffer[\hyperlink{spi_8h_a5ffe58623f478b7b960a1349530a6655}{SPI\_PACKET\_DATA\_POS}] & 0xff;
53     spiRxAction.cmd = (spiRxBuffer[\hyperlink{spi_8h_a5ffe58623f478b7b960a1349530a6655}{SPI\_PACKET\_DATA\_POS}] >> 8);
54     
55     \textcolor{keywordflow}{if}(spiRxBuffer[\hyperlink{spi_8h_a5ffe58623f478b7b960a1349530a6655}{SPI\_PACKET\_DATA\_POS}] == 0xBADA)
56     \{
57       sprintf(lcd, \textcolor{stringliteral}{"S> %x"},spiTxBuffer[\hyperlink{spi_8h_a5ffe58623f478b7b960a1349530a6655}{SPI\_PACKET\_DATA\_POS}]);
58       \hyperlink{lcd_8h_a507dd352aee8161dc556e3d1439a2be2}{lcd\_newline}(lcd);
59       
60       DEBUG\_PutString(\textcolor{stringliteral}{"S>: val: "});
61       DEBUG\_PutHexByte(spiTxBuffer[\hyperlink{spi_8h_a5ffe58623f478b7b960a1349530a6655}{SPI\_PACKET\_DATA\_POS}]);
62       DEBUG\_PutCRLF();
63     \}
64     \textcolor{keywordflow}{else}
65     \{
66       sprintf(lcd, \textcolor{stringliteral}{">S %4x %2x"}, (\textcolor{keywordtype}{int})spiRxAction.cmd, (\textcolor{keywordtype}{int})spiRxAction.val);
67       \hyperlink{lcd_8h_a507dd352aee8161dc556e3d1439a2be2}{lcd\_newline}(lcd);
68       
69       DEBUG\_PutString(\textcolor{stringliteral}{">S: cmd: "});
70       DEBUG\_PutHexByte(spiRxAction.cmd);
71       DEBUG\_PutString(\textcolor{stringliteral}{" val: "});
72       DEBUG\_PutHexByte(spiRxAction.val);
73       DEBUG\_PutCRLF();
74       DEBUG\_PutCRLF();
75       
76       \textcolor{keywordflow}{switch}(spiRxAction.cmd) \{
77         \textcolor{keywordflow}{case} \hyperlink{handler_8h_aa50e083669624eeaef782ebc867008f9}{CMD\_GET\_X\_POS} :
78           SPIS\_SpiUartClearTxBuffer();
79           spiTxBuffer[\hyperlink{spi_8h_a5ffe58623f478b7b960a1349530a6655}{SPI\_PACKET\_DATA\_POS}] = (uint16)
      \hyperlink{data_8h_a6b1a8871e30b304a6f5764c44d89e489}{dataMaster}.\hyperlink{data_8h_a7849f509240fa25127fcda8c5009f02b}{xVal};
80           SPIS\_SpiUartPutArray(spiTxBuffer, \hyperlink{spi_8h_aea54fc09a960e5a1b7096374f3eebee4}{SPI\_PACKET\_SIZE});
81           \textcolor{keywordflow}{break};
82         \textcolor{keywordflow}{case} \hyperlink{handler_8h_a51053e5251048d6ebbf4d2e23de40761}{CMD\_GET\_Y\_POS} :
83           SPIS\_SpiUartClearTxBuffer();
84           spiTxBuffer[\hyperlink{spi_8h_a5ffe58623f478b7b960a1349530a6655}{SPI\_PACKET\_DATA\_POS}] = (uint16)
      \hyperlink{data_8h_a6b1a8871e30b304a6f5764c44d89e489}{dataMaster}.\hyperlink{data_8h_a28e89368b5a1aee30ccd952ad63e8c55}{yVal};
85           SPIS\_SpiUartPutArray(spiTxBuffer, \hyperlink{spi_8h_aea54fc09a960e5a1b7096374f3eebee4}{SPI\_PACKET\_SIZE});
86           \textcolor{keywordflow}{break};
87         \textcolor{keywordflow}{case} \hyperlink{handler_8h_a4d76e78d09a00f75609569d9aa92ab98}{CMD\_GET\_Z\_POS} :
88           SPIS\_SpiUartClearTxBuffer();
89           spiTxBuffer[\hyperlink{spi_8h_a5ffe58623f478b7b960a1349530a6655}{SPI\_PACKET\_DATA\_POS}] = (uint16)
      \hyperlink{data_8h_a6b1a8871e30b304a6f5764c44d89e489}{dataMaster}.\hyperlink{data_8h_a767a084c35fdc0f1e3e41972d5415483}{zVal};
90           SPIS\_SpiUartPutArray(spiTxBuffer, \hyperlink{spi_8h_aea54fc09a960e5a1b7096374f3eebee4}{SPI\_PACKET\_SIZE});
91           \textcolor{keywordflow}{break};
92         \textcolor{keywordflow}{case} \hyperlink{handler_8h_aa2f09e60c4eeae4560da88c6b1b08c60}{CMD\_GET\_RED\_VAL} :
93           SPIS\_SpiUartClearTxBuffer();
94           spiTxBuffer[\hyperlink{spi_8h_a5ffe58623f478b7b960a1349530a6655}{SPI\_PACKET\_DATA\_POS}] = (uint16)
      \hyperlink{data_8h_a6b1a8871e30b304a6f5764c44d89e489}{dataMaster}.\hyperlink{data_8h_a3bf14030a39e71a91c0b97a624f95c5d}{rVal};
95           SPIS\_SpiUartPutArray(spiTxBuffer, \hyperlink{spi_8h_aea54fc09a960e5a1b7096374f3eebee4}{SPI\_PACKET\_SIZE});
96           \textcolor{keywordflow}{break};
97         \textcolor{keywordflow}{case} \hyperlink{handler_8h_a55d24f50aeb52afddd491d97a66c81ef}{CMD\_GET\_GREEN\_VAL} :
98           SPIS\_SpiUartClearTxBuffer();
99           spiTxBuffer[\hyperlink{spi_8h_a5ffe58623f478b7b960a1349530a6655}{SPI\_PACKET\_DATA\_POS}] = (uint16)
      \hyperlink{data_8h_a6b1a8871e30b304a6f5764c44d89e489}{dataMaster}.\hyperlink{data_8h_ae02d0c792549f1b88e80ae6eb117f2be}{gVal};
100           SPIS\_SpiUartPutArray(spiTxBuffer, \hyperlink{spi_8h_aea54fc09a960e5a1b7096374f3eebee4}{SPI\_PACKET\_SIZE});
101           \textcolor{keywordflow}{break};
102         \textcolor{keywordflow}{case} \hyperlink{handler_8h_a81052c67f996705d7eacfcea66bdde08}{CMD\_GET\_BLUE\_VAL} :
103           SPIS\_SpiUartClearTxBuffer();
104           spiTxBuffer[\hyperlink{spi_8h_a5ffe58623f478b7b960a1349530a6655}{SPI\_PACKET\_DATA\_POS}] = (uint16)
      \hyperlink{data_8h_a6b1a8871e30b304a6f5764c44d89e489}{dataMaster}.\hyperlink{data_8h_adf9e1f80891d4eaa914c2bde2502cdf2}{bVal};
105           SPIS\_SpiUartPutArray(spiTxBuffer, \hyperlink{spi_8h_aea54fc09a960e5a1b7096374f3eebee4}{SPI\_PACKET\_SIZE});
106           \textcolor{keywordflow}{break};
107         \textcolor{keywordflow}{default} :
108           \hyperlink{queue_8h_a0012fa831aa1529e5ed3a6610b733423}{pushQueue}(spiRxAction);
109           \textcolor{keywordflow}{break};
110       \}
111     \}
112   \}
113   
114   SPIS\_SpiUartClearRxBuffer();
115   SPIS\_ClearRxInterruptSource(SPIS\_GetRxInterruptSource());
116   SPIS\_EnableInt();
117 \}
\end{DoxyCode}


Her er kald-\/grafen for denne funktion\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d3/dfe/class_s_p_i_ae65228150b9bf9ec06e2c3260dcbc328_cgraph}
\end{center}
\end{figure}


\index{S\+PI@{S\+PI}!spi\+\_\+init@{spi\+\_\+init}}
\index{spi\+\_\+init@{spi\+\_\+init}!S\+PI@{S\+PI}}
\paragraph[{\texorpdfstring{spi\+\_\+init()}{spi_init()}}]{\setlength{\rightskip}{0pt plus 5cm}void spi\+\_\+init (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}\hypertarget{class_s_p_i_a5db0aceecaf7db5fbe2984e88fef3734}{}\label{class_s_p_i_a5db0aceecaf7db5fbe2984e88fef3734}


Initialiser \hyperlink{class_s_p_i}{S\+PI} modulet. 

Initailiser \hyperlink{class_s_p_i}{S\+PI} komponent på P\+SoC\textquotesingle{}en og sætter \char`\"{}\+Custom Interrupt Handler\char`\"{}.

\begin{DoxyAuthor}{Forfatter}
Jeppe Stærk (\href{mailto:201271201@uni.au.dk}{\tt 201271201@uni.\+au.\+dk}) 
\end{DoxyAuthor}


Defineret på linje 25 i filen spi.\+c.



Refereret til af main().


\begin{DoxyCode}
26 \{
27   SPIS\_SpiUartClearTxBuffer();
28   SPIS\_SpiUartClearRxBuffer();
29   SPIS\_SetCustomInterruptHandler(isr\_spi\_rx);
30   
31   SPIS\_Start();
32 \}
\end{DoxyCode}


Her er kalder-\/grafen for denne funktion\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=201pt]{d3/dfe/class_s_p_i_a5db0aceecaf7db5fbe2984e88fef3734_icgraph}
\end{center}
\end{figure}




Dokumentationen for denne klasse blev genereret ud fra filerne\+:\begin{DoxyCompactItemize}
\item 
\hyperlink{spi_8h}{spi.\+h}\item 
\hyperlink{spi_8c}{spi.\+c}\end{DoxyCompactItemize}
